---
server:
  http_listen_port: 9080
  grpc_listen_port: 0
  log_level: "debug"

positions:
  filename: /tmp/positions.yaml
  sync_period: 10s
  
clients:
  - url: http://loki:3100/loki/api/v1/push

scrape_configs:
  - job_name: tail
    static_configs:
      - targets:
          - localhost
        labels:
          job: intellio
          app: intellio
          __path__: /var/log/nginx/*.log
    pipeline_stages:
      - match:
          selector: '{app="intellio"}'
          stages:
          - regex:
              expression: '(?P<remote>[^\s]\d{1,3}\.\d{1,3})\.\d{1,3}\.\d{1,3} (?P<host>[^\s]*) (?P<user>[^\s]*) \[(?P<time>[^\]]*)\] "(?P<method>\S+)(?: +(?P<path>[^\"]*?)?(?:\?+\S*)?(?: +\S*)?)" (?P<code>[^\s]*) (?P<size>[^ ]*) "(?P<referer>[^\"]*)" "(?P<agent>[^\"]*)" (?P<cookie>[^\d]*)(?P<request_time_float>[^\s]*)'
          # - timestamp:
          #     source: time
          #     format: '02/Jan/2006:15:04:05 -0700'
          - labels:
              remote:
              host:
              user:
              method:
              path: 
              code: 
              size:
              referer:
              agent:
          # - output:
          #     source: path

  - job_name: docker
    docker_sd_configs:
      - host: "unix:///var/run/docker.sock"
        refresh_interval: 15s
      - targets:
        labels:
          job: docker
          app: docker
        filters:
          - name: label
            values: ["com.docker.compose.project=myapp"]
    relabel_configs:
      - source_labels: ['__meta_docker_container_name']
        regex: '/(.*)' 
        target_label: 'container'




        




    
