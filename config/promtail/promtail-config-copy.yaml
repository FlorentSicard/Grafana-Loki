---
server:
  http_listen_port: 9080
  grpc_listen_port: 0
  log_level: "debug"

positions:
  filename: /tmp/positions.yaml
  sync_period: 10s
  
clients:
  - url: http://loki:3100/loki/api/v1/push

scrape_configs:
  - job_name: tail
    static_configs:
      - targets:
          - localhost
        labels:
          job: intellio
          app: intellio
          __path__: /var/log/nginx/*.log
    pipeline_stages:
      - match:
          selector: '{app="intellio"}'
          stages:
          - regex:
              expression: '(?P<remote>[^\s]\d{1,3}\.\d{1,3})\.\d{1,3}\.\d{1,3} (?P<host>[^\s]*) (?P<user>[^\s]*) \[(?P<time>[^\]]*)\] "(?P<method>\S+)(?: +(?P<path>[^\"]*?)?(?:\?+\S*)?(?: +\S*)?)" (?P<code>[^\s]*) (?P<size>[^ ]*) "(?P<referer>[^\"]*)" "(?P<user_agent>[^\"]*)" (?P<cookie>[^\d]*)(?P<request_time_float>[^\s]*)'
          - labels:
              remote:
              host:
              user:
              time:
              method:
              path: 
              code: 
              size:
              referer:
              agent:
          - output:
              source: remote



    
